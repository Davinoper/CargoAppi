{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.object.keys.js\");\n\nrequire(\"core-js/modules/es.symbol.js\");\n\nrequire(\"core-js/modules/es.array.filter.js\");\n\nrequire(\"core-js/modules/es.object.to-string.js\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptor.js\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each.js\");\n\nrequire(\"core-js/modules/es.object.get-own-property-descriptors.js\");\n\nrequire(\"core-js/modules/es.array.includes.js\");\n\nrequire(\"core-js/modules/es.string.includes.js\");\n\nrequire(\"core-js/modules/es.object.values.js\");\n\nrequire(\"core-js/modules/es.array.find.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _mixins = _interopRequireDefault(require(\"../../util/mixins\"));\n\nvar _bindsAttrs = _interopRequireDefault(require(\"../../mixins/binds-attrs\"));\n\nvar _registrable = require(\"../../mixins/registrable\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n/* @vue/component */\n\n\nvar _default = (0, _mixins.default)(_bindsAttrs.default, (0, _registrable.provide)('form')\n/* @vue/component */\n).extend({\n  name: 'v-form',\n  provide: function provide() {\n    return {\n      form: this\n    };\n  },\n  inheritAttrs: false,\n  props: {\n    disabled: Boolean,\n    lazyValidation: Boolean,\n    readonly: Boolean,\n    value: Boolean\n  },\n  data: function data() {\n    return {\n      inputs: [],\n      watchers: [],\n      errorBag: {}\n    };\n  },\n  watch: {\n    errorBag: {\n      handler: function handler(val) {\n        var errors = Object.values(val).includes(true);\n        this.$emit('input', !errors);\n      },\n      deep: true,\n      immediate: true\n    }\n  },\n  methods: {\n    watchInput: function watchInput(input) {\n      var _this = this;\n\n      var watcher = function watcher(input) {\n        return input.$watch('hasError', function (val) {\n          _this.$set(_this.errorBag, input._uid, val);\n        }, {\n          immediate: true\n        });\n      };\n\n      var watchers = {\n        _uid: input._uid,\n        valid: function valid() {},\n        shouldValidate: function shouldValidate() {}\n      };\n\n      if (this.lazyValidation) {\n        // Only start watching inputs if we need to\n        watchers.shouldValidate = input.$watch('shouldValidate', function (val) {\n          if (!val) return; // Only watch if we're not already doing it\n\n          if (_this.errorBag.hasOwnProperty(input._uid)) return;\n          watchers.valid = watcher(input);\n        });\n      } else {\n        watchers.valid = watcher(input);\n      }\n\n      return watchers;\n    },\n\n    /** @public */\n    validate: function validate() {\n      return this.inputs.filter(function (input) {\n        return !input.validate(true);\n      }).length === 0;\n    },\n\n    /** @public */\n    reset: function reset() {\n      this.inputs.forEach(function (input) {\n        return input.reset();\n      });\n      this.resetErrorBag();\n    },\n    resetErrorBag: function resetErrorBag() {\n      var _this2 = this;\n\n      if (this.lazyValidation) {\n        // Account for timeout in validatable\n        setTimeout(function () {\n          _this2.errorBag = {};\n        }, 0);\n      }\n    },\n\n    /** @public */\n    resetValidation: function resetValidation() {\n      this.inputs.forEach(function (input) {\n        return input.resetValidation();\n      });\n      this.resetErrorBag();\n    },\n    register: function register(input) {\n      this.inputs.push(input);\n      this.watchers.push(this.watchInput(input));\n    },\n    unregister: function unregister(input) {\n      var found = this.inputs.find(function (i) {\n        return i._uid === input._uid;\n      });\n      if (!found) return;\n      var unwatch = this.watchers.find(function (i) {\n        return i._uid === found._uid;\n      });\n\n      if (unwatch) {\n        unwatch.valid();\n        unwatch.shouldValidate();\n      }\n\n      this.watchers = this.watchers.filter(function (i) {\n        return i._uid !== found._uid;\n      });\n      this.inputs = this.inputs.filter(function (i) {\n        return i._uid !== found._uid;\n      });\n      this.$delete(this.errorBag, found._uid);\n    }\n  },\n  render: function render(h) {\n    var _this3 = this;\n\n    return h('form', {\n      staticClass: 'v-form',\n      attrs: _objectSpread({\n        novalidate: true\n      }, this.attrs$),\n      on: {\n        submit: function submit(e) {\n          return _this3.$emit('submit', e);\n        }\n      }\n    }, this.$slots.default);\n  }\n});\n\nexports.default = _default;","map":{"version":3,"mappings":"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","names":["_bindsAttrs","extend","name","provide","form","inheritAttrs","props","disabled","Boolean","lazyValidation","readonly","value","data","inputs","watchers","errorBag","watch","handler","val","errors","Object","values","includes","$emit","deep","immediate","methods","watchInput","input","watcher","$watch","_this","$set","_uid","valid","shouldValidate","hasOwnProperty","validate","filter","length","reset","forEach","resetErrorBag","setTimeout","_this2","resetValidation","register","push","unregister","found","find","i","unwatch","$delete","render","h","staticClass","attrs","novalidate","attrs$","on","submit","e","_this3","$slots","default"],"sourceRoot":"","sources":["../../../src/components/VForm/VForm.ts"],"sourcesContent":["// Components\nimport VInput from '../VInput/VInput'\n\n// Mixins\nimport mixins from '../../util/mixins'\nimport BindsAttrs from '../../mixins/binds-attrs'\nimport { provide as RegistrableProvide } from '../../mixins/registrable'\n\n// Helpers\nimport { VNode } from 'vue'\n\ntype ErrorBag = Record<number, boolean>\ntype VInputInstance = InstanceType<typeof VInput>\ntype Watchers = {\n  _uid: number\n  valid: () => void\n  shouldValidate: () => void\n}\n\n/* @vue/component */\nexport default mixins(\n  BindsAttrs,\n  RegistrableProvide('form')\n  /* @vue/component */\n).extend({\n  name: 'v-form',\n\n  provide (): object {\n    return { form: this }\n  },\n\n  inheritAttrs: false,\n\n  props: {\n    disabled: Boolean,\n    lazyValidation: Boolean,\n    readonly: Boolean,\n    value: Boolean,\n  },\n\n  data: () => ({\n    inputs: [] as VInputInstance[],\n    watchers: [] as Watchers[],\n    errorBag: {} as ErrorBag,\n  }),\n\n  watch: {\n    errorBag: {\n      handler (val) {\n        const errors = Object.values(val).includes(true)\n\n        this.$emit('input', !errors)\n      },\n      deep: true,\n      immediate: true,\n    },\n  },\n\n  methods: {\n    watchInput (input: any): Watchers {\n      const watcher = (input: any): (() => void) => {\n        return input.$watch('hasError', (val: boolean) => {\n          this.$set(this.errorBag, input._uid, val)\n        }, { immediate: true })\n      }\n\n      const watchers: Watchers = {\n        _uid: input._uid,\n        valid: () => {},\n        shouldValidate: () => {},\n      }\n\n      if (this.lazyValidation) {\n        // Only start watching inputs if we need to\n        watchers.shouldValidate = input.$watch('shouldValidate', (val: boolean) => {\n          if (!val) return\n\n          // Only watch if we're not already doing it\n          if (this.errorBag.hasOwnProperty(input._uid)) return\n\n          watchers.valid = watcher(input)\n        })\n      } else {\n        watchers.valid = watcher(input)\n      }\n\n      return watchers\n    },\n    /** @public */\n    validate (): boolean {\n      return this.inputs.filter(input => !input.validate(true)).length === 0\n    },\n    /** @public */\n    reset (): void {\n      this.inputs.forEach(input => input.reset())\n      this.resetErrorBag()\n    },\n    resetErrorBag () {\n      if (this.lazyValidation) {\n        // Account for timeout in validatable\n        setTimeout(() => {\n          this.errorBag = {}\n        }, 0)\n      }\n    },\n    /** @public */\n    resetValidation () {\n      this.inputs.forEach(input => input.resetValidation())\n      this.resetErrorBag()\n    },\n    register (input: VInputInstance) {\n      this.inputs.push(input)\n      this.watchers.push(this.watchInput(input))\n    },\n    unregister (input: VInputInstance) {\n      const found = this.inputs.find(i => i._uid === input._uid)\n\n      if (!found) return\n\n      const unwatch = this.watchers.find(i => i._uid === found._uid)\n      if (unwatch) {\n        unwatch.valid()\n        unwatch.shouldValidate()\n      }\n\n      this.watchers = this.watchers.filter(i => i._uid !== found._uid)\n      this.inputs = this.inputs.filter(i => i._uid !== found._uid)\n      this.$delete(this.errorBag, found._uid)\n    },\n  },\n\n  render (h): VNode {\n    return h('form', {\n      staticClass: 'v-form',\n      attrs: {\n        novalidate: true,\n        ...this.attrs$,\n      },\n      on: {\n        submit: (e: Event) => this.$emit('submit', e),\n      },\n    }, this.$slots.default)\n  },\n})\n"]},"metadata":{},"sourceType":"script"}